<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>{% if q %}{{ q + ' - ' }}{% endif %}Internet Archive search</title>
{# Copyright(c)2012 Internet Archive. Software license GPL version 2. #}
{# Written by Edward Betts <edward@archive.org> #}
<script language="javascript" type="text/javascript" src="http://edward.openlibrary.org/javascript/jquery/jquery.js"></script>

<link href="{{url_for('static', filename='bootstrap/css/bootstrap.css')}}" rel="stylesheet">

<style>
body {
    padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
}

input.filterbox {
    width:  100%;
}
div.nowrap { display: inline-block; }
.nowrap { white-space: nowrap; }
th { white-space: nowrap; }

img.thumb { max-width: 80px; max-height: 80px; overflow: hidden; }

.selected { 
  padding: 2px;
  margin: 2px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
  color: #ffffff;
  background-color: #0088cc;
}

</style>

<link href="{{url_for('static', filename='bootstrap/css/bootstrap-responsive.css')}}" rel="stylesheet">

</head>
<body>

    {% set mediatype_icons = {
        'texts': 'book',
        'movies': 'film',
        'audio':'headphones', 
        'image': 'picture', 
        'etree': 'music', 
        'software':'cog',
        'data': 'file',
        'collection': 'list',
        'other': 'asterisk',
        'education': 'pencil',
    } %}


<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
    <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">

        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        </a>
        <a class="brand" href="{{ url_for('search_page')}}">Internet Archive</a>
        <div class="nav-collapse">
        <ul class="nav">
            <li><a href="{{ url_for('search_page') + '?' + changequery({'view':None})}}">Search</a></li>
            <li class="active"><a href="{{ url_for('grid_page') + '?' + changequery({})}}">Grid</a></li>
        </ul>
        <form class="navbar-search pull-right">
            <input type="text" name="q" class="search-query" placeholder="Search">
        </form>
        </div><!--/.nav-collapse -->
    </div>
    </div>
</div>

<div class="container-fluid">

    {% set field_sets = [
        (None, None, 'Default'),
        ('all', 'asterisk', 'All'), 
        ('collection', None, 'Collections'), 
        ('tv', 'film', 'TV'),
        ('books', 'book', 'Books'), 
        ('etree', 'music', 'etree'),
        ('software', 'cog', 'Software'),
        ('usfederalcourts', None, 'Court docs'),
        ('nasa', None, 'NASA'),
        ('librivox', None, 'Librivox')]
    %}

    fields:
    <ul class="nav nav-pills">
    {% for field_set, icon, label in field_sets %}
        {% if (field_set == None and not request.args.field_set and not request.args.fields) or  request.args.field_set == field_set %}
            <li class="active">
        {% else %}
            <li>
        {% endif %}
        <a href="?{{changequery({'extra': None, 'fields': None, 'field_set': field_set})}}">{% if icon %}<i class="icon-{{icon}}">{% endif %}</i>{{ label }}</a></li>
    {% endfor %}
        <li{% if (request.args.fields) %} class="active"{% endif %}>
            <a href="{{ url_for('select_fields_page') + '?' + changequery({})}}">select</a>
        </li>
    </ul>

    rows: 
    <ul class="nav nav-pills">
    {% for row_count in [10, 50, 100, 200, 500, 1000, 2000, 5000, 10000, 20000, 50000] %}
        {% if row_count == rows %}<li class="active">{% else %}<li>{% endif %}
        <a href="?{{changequery({'rows': row_count })}}">{{ row_count }}</a></li>
    {% endfor %}
    </ul>


{% if results %}

        {{ comma(results.response.numFound) }} items found
        in {{ '%.4f' | format(t_solr) }} seconds<p>
{% endif %}

<form action="{{url_for('grid_page')}}" method="get">

<input type="hidden" name="sort" value="{{ request.args.sort }}">
<input type="hidden" name="fields" value="{{ request.args.fields }}">
<input type="hidden" name="field_set" value="{{ request.args.field_set }}">

<table class="table table-striped table-bordered table-condensed draggable">
{% if facet_row %}
<tr>
<td></td>
{% for f in fields %}
{% if f in results.facet_counts.facet_fields %}
    {% set facet_field = f %}
{% elif  f + '_facet' in results.facet_counts.facet_fields %}
    {% set facet_field = f + '_facet' %}
{% else %}
    {% set facet_field = None %}
{% endif %}
<td style="vertical-align: bottom">
{% if facet_field %}
    <table>
    {% for k, v in results.facet_counts.facet_fields[facet_field] | reverse %}
    <tr><td>{{ k }}</td><td>{{ v }}</td></tr>
    {% endfor %}
    </table>
{% endif %}
</td>
{% endfor %}
</tr>
{% endif %}
<tr>
<td></td>
{% for f in fields %}
<th>{{ f if f != 'date_str' else 'date' }}{% if f != 'identifier' %} <a href="?{{zap_field(fields, f)}}">&times;</a>{% endif %}
{% if f in single_value_fields %}
    <strong>
    {% set sort = request.args.sort %}
    {% if sort == f + ' desc'%}<span class="selected">&#x2b06;</span>{% else %}
    <a href="?{{changequery({'page': None, 'sort': f + ' desc'})}}">&#x2b06;</a>
    {% endif %}

    {% if sort == f + ' asc'%}<span class="selected">&#x2b07;</span>{% else %}
    <a href="?{{changequery({'page': None, 'sort': f + ' asc'})}}">&#x2b07;</a>
    </strong>
    {% endif %}
{% endif %}
{% if results and (f in results.facet_counts.facet_fields or f + '_facet' in results.facet_counts.facet_fields) %}
<a href="{{ url_for('facet_page', field=f) }}?{{changequery({})}}"><img src="http://www.us.archive.org/images/histogram-icon.gif"></a>
{% endif %}
</th>
{% endfor %}
</tr>
<tr>
<td><input type="submit" value="Search" class="btn-primary"></td>
{% for f in fields %}
{% set f_name = f if f != 'date_str' else 'date' %}
<td><input class="filterbox" name="{{ f_name }}" value="{{ request.args.get(f_name, '')}}"></td>
{% endfor %}
</tr>
{% for doc in (results.response.docs if results else []) %}
{% set details = "http://www.archive.org/details/" + doc.identifier %}
<tr>
<td>
{% if doc.thumb_path %}
    <a href="{{ details }}"><img class="thumb" src="http://www.archive.org/download/{{ doc.identifier }}/{{ doc.thumb_path }}"></a>
{% endif %}
</td>
{% for f in fields %}
<td>
    {% if f == 'identifier' %}
        {% if 'tvarchive' in doc.collection %}<span class="nowrap">{% endif %}
        <a href="{{ details }}" class="nowrap">{{ doc.identifier }}</a>
        {% if doc.thumb_path and (doc.noindex or doc.get('access-restricted')) %}<br>{% endif %}
        {% if doc.noindex %}<span class="label label-warning">noindex</span>{% endif %}
        {% if doc.get('access-restricted') %}<span class="label label-warning">restricted</span>{% endif %}
        {% if 'tvarchive' in doc.collection %}</span>{% endif %}
</td>
    {% elif f == 'mediatype' %}
        {% if doc.mediatype %}
            {% if doc.mediatype in mediatype_icons %}<i class="icon-{{mediatype_icons[doc.mediatype]}}"></i>{% endif %}
            {{ doc.mediatype }}
            {% set v = doc.mediatype %}
            <div class="nowrap"><a href="?{{changequery({f: request.args.get(f, '') + '"%s"' % solr_esc(v)})}}"><i class="icon-plus-sign" alt="+"></i></a><a href="?{{changequery({f: request.args.get(f, '') + '-"%s"' % solr_esc(v)})}}"><i class="icon-minus-sign" alt="-"></i></a></div>
        {% else %}
            <span class="label label-important">missing</span>
        {% endif %}
    {% elif f == 'title' %}
        {% set title = doc.title %}
        {% if len(doc.title) < 50 %}
            <div class="nowrap">{{ title }}</div>
        {% elif len(doc.title) > 80 %}
            <div title="{{ title }}">{{ title | truncate(length=80) }}</div>
        {% else %}
            {{ title }}
        {% endif %}
    {% elif f.startswith('description') and 'tvarchive' in doc.collection %}
        <div class="nowrap">{{ doc[f] }}</div>
    {% elif f == 'item_size' %}
        {% if f in doc %}
            {{ fmt_filesize(doc[f]) }}
        {% endif %}
    {% elif f not in single_value_fields %}
        <div style="display:inline-block">
        {% set values = doc.get(f, []) %}
        {% for v in values %}
            <span class="nowrap">{{v}}
<a href="?{{changequery({f: request.args.get(f, '') + '"%s"' % solr_esc(v)})}}"><i class="icon-plus-sign" alt="+"></i></a><a href="?{{changequery({f: request.args.get(f, '') + '-"%s"' % solr_esc(v)})}}"><i class="icon-minus-sign" alt="-"></i></a>
            </span>
        {% endfor %}
        </div>
    {% elif f in ('publisher', 'scanningcenter') %}
        <div style="display:inline-block">
        {% set v = doc.get(f) %}
        {% if v %}
        {{ v }}
        <span class="nowrap"><a href="?{{changequery({f: request.args.get(f, '') + '"%s"' % v})}}"><i class="icon-plus-sign" alt="+"></i></a><a href="?{{changequery({f: request.args.get(f, '') + '-"%s"' % v})}}"><i class="icon-minus-sign" alt="-"></i></a></span>
        {% endif %}
        </div>
    {% elif f == 'downloads' %}
        {{ comma(doc.get(f, 0)) }}
    {% elif doc.get(f) %}
        {% if isinstance(doc[f], basestring) and len(doc[f]) < 60 %}
            <span class="nowrap">{{ doc[f] }}</span>
        {% else %}
            {{ doc[f] }}
        {% endif %}
    {% endif %}
</td>
{% endfor %}
</tr>
{% endfor %}
</table>
</form>

{% if results %}
{% include 'pager.html' %}
{% endif %}

     <hr>

      <footer>
        <p>Internet Archive</p>

      </footer>

    </div> <!-- /container -->

    <script src="{{url_for('static', filename='js/dragtable.js')}}"></script>
    {% for plugin in ['modal', 'transition', 'tooltip', 'popover', 'dropdown'] %}
    <script src="{{url_for('static', filename='bootstrap/js/bootstrap-' + plugin + '.js')}}"></script>
    {% endfor %}

</body>
</html>
